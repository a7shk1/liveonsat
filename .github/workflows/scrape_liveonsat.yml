# Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ùƒ ÙÙ„Ùˆ
name: Scrape, Filter, and Translate Matches

on:
  schedule:
    - cron: "*/15 * * * *"  # ÙƒÙ„ 15 Ø¯Ù‚ÙŠÙ‚Ø© (Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¯Ù…Ø©)
  workflow_dispatch:

permissions:
  contents: write

jobs:
  scrape-and-filter:
    runs-on: ubuntu-latest

    steps:
      # 1. Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
      - name: Checkout repo
        uses: actions/checkout@v4

      # 2. ØªÙ†ØµÙŠØ¨ Ø¨Ø§ÙŠØ«ÙˆÙ†
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3. ØªØ«Ø¨ÙŠØª ÙƒÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© googletrans)
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install playwright beautifulsoup4 googletrans==4.0.0-rc1
          playwright install --with-deps chromium

      # 4. ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø£ÙˆÙ„
      - name: Run Scraper (scrape_liveonsat_only.py)
        run: python scripts/scrape_liveonsat_only.py

      # 5. ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±Ø¨Øª Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø«Ø§Ù†ÙŠ
      - name: Run Filter and Translator (filter_json.py)
        run: python scripts/filter_json.py

      # 6. Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙÙŠÙ† Ø§Ù„Ù†Ø§ØªØ¬ÙŠÙ† ÙÙŠ Ø§Ù„Ø±ÙŠØ¨Ùˆ
      - name: Commit & push if changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # Ø±Ø³Ø§Ù„Ø© ÙƒÙˆÙ…ÙŠØª ÙˆØ§Ø¶Ø­Ø©
          commit_message: "ğŸ“Š Chore: Update scraped and filtered match data"
          # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù„ÙÙŠÙ† Ù„Ù„Ø­ÙØ¸
          file_pattern: "matches/liveonsat_raw.json matches/filtered_matches.json"
